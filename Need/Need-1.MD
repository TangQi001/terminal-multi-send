---

## 终端列表视图优化：需求分析报告

### 1. 需求背景与目标

* **当前痛点：** 现有的终端/工具列表采用单维度、平铺式的展示方式（如截图所示，已有 26 个实例）。随着终端实例和工具类型的增多，用户在下发批量命令前，查找、定位目标终端的效率会显著降低，容易发生误选或漏选。
* **优化目标：** 引入**排序**、**自定义排序**和**分组**功能，实现列表的多维度精细化管理，降低用户的视觉负担，提升批量操作时的准确性和效率。

### 2. 用户场景分析

* **场景一（分类执行）：** 用户需要针对特定领域的所有工具（如“安全工具”、“密码学工具”）下发统一指令。此时用户希望列表能按“业务类型”**分组**，并且能一键勾选该分组下的所有节点。
* **场景二（规律查找）：** 用户习惯性地按照工具名称的字母顺序，或者进程启动的先后顺序（PID 大小）来查找目标。此时用户需要基础的**排序**功能。
* **场景三（高频工作流）：** 用户有自己一套固定的高频使用工具，不符合常规的字母或 PID 排序。此时用户希望通过拖拽进行**自定义排序**，将最常用的工具置顶。

---

### 3. 功能需求详细定义 (Functional Requirements)

#### 3.1 分组功能 (Grouping)

* **分组维度：**
  * 支持“无分组”（平铺状态）。
  * 支持按“工具类型/属性”分组（如：基础终端、安全类、网络类、DevOps 类）。*注：需后端数据支持 group 字段，或前端根据名称正则匹配。*
* **交互逻辑：**
  * 提供可视化的分组视图（如带有灰色背景条的分组标题）。
  * **折叠/展开：** 每个分组应支持折叠和展开（默认展开），以便用户隐藏当前不关注的模块。
  * **分组级联选择：** 在分组标题处提供一个复选框，勾选后即可全选/反选该分组下的所有子项。

#### 3.2 基础排序功能 (Sorting)

* **排序维度：**
  * **按名称排序：** 支持 A-Z / Z-A 字典序排列（兼容中文拼音）。
  * **按 PID 排序：** 支持升序/降序，便于按照进程启动先后顺序查看。
  * **按选中状态排序 (可选加分项)：** 将已勾选的项统一浮动到顶部，方便在“Select All”或复杂勾选后确认操作目标。
* **交互逻辑：**
  * 在列表上方操作栏（`Refresh`, `Select All` 右侧）增加“排序方式”下拉控件或切换按钮。

#### 3.3 自定义排序功能 (Custom Drag-and-Drop)

* **操作触发：**
  * 仅在“无分组”或特定“自定义视图”模式下开启，避免与基础排序/分组逻辑发生冲突。
  * 提供明确的视觉抓手（如列表项左侧或右侧的 ≡ 拖拽图标）。
* **交互过程：**
  * 支持长按或点击抓手后，上下拖拽列表项改变顺序。
  * 拖拽过程中需有占位符（Placeholder）提示目标落点，以及被拖拽项的悬浮阴影效果。
* **状态持久化：**
  * 用户调整后的自定义顺序必须被保存（本地 LocalStorage 或提交至后端数据库），确保页面刷新或下次登录后顺序不丢失。

---

### 4. 非功能性需求 (Non-Functional Requirements)

* **性能要求：** 列表数据可能较多（几十到上百），拖拽排序和频繁的分组切换不应引起页面卡顿。若未来数据量级达到数百，需考虑引入虚拟列表（Virtual Scroll）技术。
* **空间利用：** 新增的排序和分组控件应尽量融入现有紧凑的 UI 布局中，不能大幅挤压下方代码输入框（Command 区域）的空间。
* **兼容性：** 自定义拖拽功能需完全兼容主流现代浏览器（Chrome, Edge, Firefox, Safari）。

---

### 5. 异常与边界情况处理

1. **分组名称为空：** 当某些进程或终端没有匹配到明确的分组属性时，统一归入“未分组”或“其他”目录下。
2. **搜索与排序的叠加：** 如果后续引入搜索功能，搜索结果应保留当前的分组和排序规则。
3. **多终端并发更新：** 当后台有新终端启动或旧终端关闭，触发页面数据刷新（Refresh）时，现有的展开/折叠状态及自定义排序原则上应尽量保持不变，新进入的实例按默认规则追加。
